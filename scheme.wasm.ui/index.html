<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>scheme.wasm</title>
  <script>
    window.addEventListener('error', event => {
      const app = document.getElementById('app');
      const head = document.createElement('h2');
      const details = document.createElement('div');
      if (event.message.toLowerCase().indexOf('script error') >= 0) {
        head.append('Script Error');
        details.append('See console for details');
      } else {
        head.append('Uncaught Error');
        const message = [
          'Message: ' + event.message,
          'Url: ' + event.filename,
          'Line: ' + event.lineno + ', column: ' + event.colno,
          'Error: ' + event.error
        ];
        message.forEach(el => {
          details.append(el);
          details.append(document.createElement('br'));
        });
      }
      app.append(head);
      app.append(details);
      return false;
    });
  </script>
</head>

<body>
  <div id="app"></div>
  <script src="./vs/loader.js"></script>
  <script>
    const baseUrl = location.origin + location.pathname.split('/').slice(0, -1).join('/');
    require.config({ paths: { vs: `${baseUrl}/vs` } });
    window.MonacoEnvironment = {
      getWorkerUrl: function (moduleId, label) {
        return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
          self.MonacoEnvironment = { baseUrl: ${JSON.stringify(baseUrl)} };
          importScripts(${JSON.stringify(baseUrl)}+"/vs/base/worker/workerMain.js");`
        )}`;
      }
    };

    function getMonaco() {
      return new Promise((resolve, reject) => {
        require(["vs/editor/editor.main"], function (monaco) {
          window.monaco = monaco;
          console.log("Loaded editor.main");
          resolve();
        }, reject);
      });
    }
  </script>
</body>

</html>
